{"version":3,"sources":["../lib/lib/dictionary.js","../lib/lib/utils.js","../lib/lib/LazyLoader.js","index.js"],"names":["getDictionary","images","relPath","dictionary","key","value","values","Object","keys","map","e","isImage","isFolder","ext","translateSrc","src","translateSrcset","srcset","split","reduce","current","slice","lastIndexOf","trim","size","translateDataset","img","dataset","toArray","targets","document","querySelectorAll","length","call","preload","preloader","cloneNode","removeAttribute","module","exports","LazyLoader","settledCountdown","preloaders","hasObservers","_init","forEach","onAllSettledCb","addEventListener","parentNode","replaceChild","onLoadCb","_countDown","onErrorCb","options","root","rootMargin","threshold","intersectObs","IntersectionObserver","intersectCb","visibleObs","visibleCb","that","entries","intersectionRatio","target","_attachListeners","observe","push","onIntersectCb","unobserve","onVisibleCb","_setObservers","cb","getElementById","test","loadWithIO","onLoad","console","log","onError","onAllSettled","onVisible","onIntersect"],"mappings":";;AEAA,ADAA,AEAA;;ADCA;;ADCA,IAAMc,YAAY,GAAG,SAAfA,YAAe,CAAAC,GAAG;ADFxB,ACEwB,SACvBZ,oBAAYY,GAAZ,KAAqBA,GADE;AAAA,CAAxB;;AAIA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,MAAM;AAAA,SAC7BA,MAAM,CAACC,KAAP,CAAa,GAAb,EAAkBC,MAAlB,CAAyB,UAACF,MAAD,EAASG,OAAT,EAAqB;AAC7C,QAAML,GAAG,GAAGK,OAAO,CAACC,KAAR,CAAc,CAAd,EAAiBD,OAAO,CAACE,WAAR,CAAoB,GAApB,CAAjB,EAA2CC,IAA3C,EAAZ;AACA,QAAMC,IAAI,GAAGJ,OAAO,CAACC,KAAR,CAAcD,OAAO,CAACE,WAAR,CAAoB,GAApB,IAA2B,CAAzC,CAAb;AACA,qBAAWL,MAAM,IAAIA,MAAM,GAAG,GAA9B,cAAuCH,YAAY,CAACC,GAAD,CAAnD,cAA8DS,IAA9D;AACA,GAJD,EAIG,EAJH,EAIOD,IAJP,EAD6B;AAAA,CAA9B;;AAQA,IAAME,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAAC,GAAG,EAAI;ADZhC,ACYgC,IDZ1B1B,aAAa,GAAG,CCaC0B,GAAG,CAACC,IDbrB3B,GCY0B,UDZV,CAACC,MAAD,EAA0B;AAAA,ACYhB,ICX1BuC,EFDyBtC,ACaxBa,GADyB,IDZgB,YCazCA,GADyB,wDDZS,EAAO;AAC/C,ACW+B,MDX3BZ,ACYOc,MADoB,IDXjB,GAAG,EAAjB,OCYWA,MADoB;AAE/BF,EAAAA,GAAG,KAAKW,GAAG,CAACC,OAAJ,CAAYZ,GAAZ,GAAkBD,YAAY,CAACC,GAAD,CAAnC,CAAH;ACXA,AFH+C,ACe/CE,EAAAA,MAAM,KAAKS,GAAG,CAACC,KCZH1B,EDYD,CAAYgB,GCZvB,CFDSb,CECW,CDYT,CDfoC,ECefY,eAAe,CAACC,MAAD,CAAzC,CAAN;ACZoB,AFAnB,ACaD,CAJD,ODTQZ,KAAK,GAAGJ,MAAM,CAAEG,GAAF,CAApB;AACIE,IAAAA,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYP,MAAM,CAAEG,GAAF,CAAlB,EAA2BK,GAA3B,CAA+B,UAAAC,CAAC;AEA7C,AFA6C,ACe/C,IAAMkB,KCfC3B,EDeM,EDfsCA,CCenC,CCfd,GAAc,CFAyC,CAAEG,GAAF,ACenDwB,CDf6C,CAAelB,CAAf,CAAJ,GCe/B,CAAAmB,OCfQ5B,ADeD,EAAI,ICfX,CAAd;AACA,AFD6C,ACgB9C,KDhBc,CAJiC,ACoB3C,GCfEwC,IDeKZ,OAAP,KCfH,ADesB,GCfE,KAAK5B,ADe9B,EACC4B,IChBwB,CAAYG,EDgB7B,GAAGF,CChBV,ODgBkB,CAACC,gBAAT,CAA0BF,OAA1B,CAAV;ACfA,AFDA,ACiBD,MAAI,CAACA,CDjBElB,CECD+B,KDgBM,CDjBE,ACiBDV,GDjBI,CEChB,EDgBD,CChBmB,CDiBlB,CCjBA,CFDuB1B,KCkBhB,CDlBsB,ACkBpBuB,CDlBsB,CAAF,CAAb,ICkBT,CDlBgC,ACkBvC,QDlBA;AEEA,AFDA,ACkBD,QDlBOjB,CECD+B,ADiBC,GAAGtB,IDlBK,CCkBR,CAASY,CDlBE,EECjB,CDiBM,CAAcJ,CCjBA,GFDIvB,EECxB,CDiBM,CAAP,EDlB+B,CAAE,CAAF,CAAb,MAAuB,QAAxC;ACmBD,CAND;ACXE,AFDA,QAAIK,CECCiC,KAAL,CFDA,EAAa;AEEb,AFDC,ACmBH,IAAMV,MDnBGrB,CCmBI,EDnBD,CCmBI,EDnBDN,MAAM,CAACC,ACmBhB0B,IDnBS,CAAY7B,ECmBX,CAAAqB,EDnBD,CCmBI,CDnBgB,CAApB,ACmBQ,CDnBpB;AACAvB,ACmBF,MDnBEA,ACmBIgC,SAAS,CDnBH,ECmBMT,GAAG,CAACU,KDnBJlC,ICmBA,CAAc,EDnBP,GAAGE,ACmBV,CAAlB,EDnBY,cAAyBS,GAAzB,EAAV,GAA8CR,KAAK,CAAEQ,GAAF,CAAnD;AACA,ACiBoB,KDpBrB,MAIK,IAAID,QAAJ,EAAc,ECkBIuB,SAAS,CAACR,OAFZ;ADfpBxB,ACeoB,MDfpBA,ACiBMY,GAFc,ODfV,eCiBJA,GAFc,iBDfFZ,UAAR,GAAuBH,aAAa,CAACK,KAAD,YAAYH,OAAO,GAAGE,GAAtB,OAApC,CAAV;AACA,ACcoB,MAETa,MAFS,gBChBd,M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","file":"test.e31bb0bc.js","sourceRoot":"..\\test","sourcesContent":["import images from '../../src/assets/**/*.*';\r\n\r\nconst getDictionary = (images, relPath = '') => {\r\n\tlet dictionary = {};\r\n\tfor (let key in images) {\r\n\t\tconst value = images[ key ];\r\n\t\tvar values = Object.keys(images[ key ]).map(e => images[ key ][ e ]);\r\n\t\tconst isImage = typeof values[ 0 ] === \"string\";\r\n\t\tconst isFolder = typeof values[ 0 ] === \"object\";\r\n\t\tif (isImage) {\r\n\t\t\tconst ext = Object.keys(value)[ 0 ];\r\n\t\t\tdictionary[ `${ relPath + key }.${ ext }` ] = value[ ext ];\r\n\t\t}\r\n\t\telse if (isFolder) {\r\n\t\t\tdictionary = { ...dictionary, ...getDictionary(value, `${ relPath + key }/`) };\r\n\t\t}\r\n\t}\r\n\treturn dictionary;\r\n};\r\n\r\nexport default getDictionary(images);","import dictionary from './dictionary';\r\n\r\nconst translateSrc = src => (\r\n\tdictionary[ src ] || src\r\n);\r\n\r\nconst translateSrcset = srcset => (\r\n\tsrcset.split(',').reduce((srcset, current) => {\r\n\t\tconst src = current.slice(0, current.lastIndexOf(' ')).trim();\r\n\t\tconst size = current.slice(current.lastIndexOf(' ') + 1);\r\n\t\treturn `${ srcset && srcset + ',' } ${ translateSrc(src) } ${ size }`;\r\n\t}, '').trim()\r\n);\r\n\r\nconst translateDataset = img => {\r\n\tlet { src, srcset } = img.dataset;\r\n\tsrc && (img.dataset.src = translateSrc(src));\r\n\tsrcset && (img.dataset.srcset = translateSrcset(srcset));\r\n};\r\n\r\n\r\nconst toArray = targets => {\r\n\tif (typeof targets === 'string')\r\n\t\ttargets = document.querySelectorAll(targets);\r\n\tif (!targets.length)\r\n\t\treturn [ targets ];\r\n\treturn [].slice.call(targets);\r\n};\r\n\r\nconst preload = img => {\r\n\tconst preloader = img.cloneNode(false);\r\n\tconst { src, srcset } = preloader.dataset;\r\n\r\n\tif (src) {\r\n\t\tpreloader.src = src;\r\n\t\tpreloader.removeAttribute('data-src');\r\n\t}\r\n\tif (srcset) {\r\n\t\tpreloader.srcset = srcset;\r\n\t\tpreloader.removeAttribute('data-srcset');\r\n\t}\r\n\treturn preloader;\r\n};\r\n\r\nmodule.exports = {\r\n\ttranslateDataset,\r\n\ttoArray,\r\n\tpreload\r\n};","import images from '../../src/assets/**/*.*';\r\nimport { translateDataset, toArray, preload } from './utils';\r\n\r\nclass LazyLoader {\r\n\r\n\tconstructor(images) {\r\n\t\tthis.images = toArray(images);\r\n\t\tthis.settledCountdown = this.images.length;\r\n\t\tthis.preloaders = [];\r\n\t\tthis.hasObservers = false;\r\n\t\tthis._init();\r\n\t}\r\n\r\n\t_init() {\r\n\t\tthis.images.forEach(translateDataset);\r\n\t}\r\n\r\n\t_countDown() {\r\n\t\tthis.settledCountdown--;\r\n\t\t!this.settledCountdown && this.onAllSettledCb && this.onAllSettledCb(this.preloaders);\r\n\t}\r\n\r\n\t_attachListeners(img, preloader) {\r\n\t\tpreloader.addEventListener('load', e => {\r\n\t\t\timg.parentNode && img.parentNode.replaceChild(preloader, img);\r\n\t\t\tthis.onLoadCb && this.onLoadCb(e);\r\n\t\t\tthis._countDown();\r\n\t\t});\r\n\t\tpreloader.addEventListener('error', e => {\r\n\t\t\timg.parentNode && img.parentNode.replaceChild(preloader, img);\r\n\t\t\tthis.onErrorCb && this.onErrorCb(e);\r\n\t\t\tthis._countDown();\r\n\t\t});\r\n\t}\r\n\r\n\t_setObservers(options = {}) {\r\n\t\toptions = {\r\n\t\t\troot: options.root,\r\n\t\t\trootMargin: options.rootMargin || '500px 500px 500px 500px',\r\n\t\t\tthreshold: options.threshold || 0.01\r\n\t\t};\r\n\r\n\t\tthis.intersectObs = new IntersectionObserver(intersectCb, options);\r\n\t\tthis.visibleObs = new IntersectionObserver(visibleCb, { ...options, rootMargin: '0px 0px 0px 0px' });\r\n\t\tconst that = this;\r\n\r\n\t\tfunction intersectCb(entries) {\r\n\t\t\tentries.forEach(e => {\r\n\t\t\t\tif (!e.intersectionRatio) return;\r\n\t\t\t\tconst preloader = preload(e.target);\r\n\t\t\t\tthat._attachListeners(e.target, preloader);\r\n\t\t\t\tthat.visibleObs.observe(preloader);\r\n\t\t\t\tthat.preloaders.push(preloader);\r\n\t\t\t\tthat.onIntersectCb && that.onIntersectCb(e);\r\n\t\t\t\tthis.unobserve(e.target);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction visibleCb(entries) {\r\n\t\t\tentries.forEach(e => {\r\n\t\t\t\tif (!e.intersectionRatio) return;\r\n\t\t\t\tthat.onVisibleCb && that.onVisibleCb(e);\r\n\t\t\t\tthis.unobserve(e.target);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.hasObservers = true;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tloadAll() {\r\n\t\tthis.images.forEach(img => {\r\n\t\t\tconst preloader = preload(img);\r\n\t\t\tthis.preloaders.push(preloader);\r\n\t\t\tthis._attachListeners(img, preloader);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\tloadWithIO(options = {}) {\r\n\t\tthis._setObservers(options);\r\n\t\tthis.images.forEach(img => {\r\n\t\t\tthis.intersectObs.observe(img);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonLoad(cb) {\r\n\t\tthis.onLoadCb = cb;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonError(cb) {\r\n\t\tthis.onErrorCb = cb;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonAllSettled(cb) {\r\n\t\tthis.onAllSettledCb = cb;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonVisible(cb) {\r\n\t\tthis.onVisibleCb = cb;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonIntersect(cb) {\r\n\t\tthis.onIntersectCb = cb;\r\n\t\treturn this;\r\n\t}\r\n\r\n}\r\n\r\nconst options = {\r\n\troot: document.getElementById('root'),\r\n\trootMargin: '200px 200px 200px 200px',\r\n\tthreshold: 0.001\r\n};\r\n\r\nconst test = new LazyLoader('img');\r\n\r\n// test\r\n// \t.loadAll()\r\n// \t.onLoad((e) => console.log('onLoadCb'))\r\n// \t.onError((e) => console.log('onErrorCb'))\r\n// \t.onAllSettled(() => console.log('allSettledCb'));\r\n\r\ntest\r\n\t.loadWithIO(options)\r\n\t.onLoad((e) => console.log('onLoadCb'))\r\n\t.onError((e) => console.log('onErrorCb'))\r\n\t.onAllSettled(() => console.log('allSettledCb'))\r\n\t.onVisible(() => console.log('onVisibleCb'))\r\n\t.onIntersect(() => console.log('onIntersectCb'));","import LazyLoader from '../lib/lib/LazyLoader'"]}