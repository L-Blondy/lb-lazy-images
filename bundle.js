"use strict";var _=_interopRequireDefault(require("../../src/assets/**/*.*"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function ownKeys(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var getDictionary=function s(i,t){var a,c=1<arguments.length&&void 0!==t?t:"",l={};for(var e in i){!function(e){var t,r=i[e],n="string"==typeof(a=Object.keys(i[e]).map(function(t){return i[e][t]}))[0],o="object"===_typeof(a[0]);n?(t=Object.keys(r)[0],l["".concat(c+e,".").concat(t)]=r[t]):o&&(l=_objectSpread(_objectSpread({},l),s(r,"".concat(c+e,"/"))))}(e)}return l},dictionary=getDictionary(_.default),translateSrc=function(t){return dictionary[t]||t},translateSrcset=function(t){return t.split(",").reduce(function(t,e){var r=e.slice(0,e.lastIndexOf(" ")).trim(),n=e.slice(e.lastIndexOf(" ")+1);return"".concat(t&&t+","," ").concat(translateSrc(r)," ").concat(n)},"").trim()},translateDataset=function(t){var e=t.dataset,r=e.src,n=e.srcset;r&&(t.dataset.src=translateSrc(r)),n&&(t.dataset.srcset=translateSrcset(n))},toArray=function(t){return"string"==typeof t&&(t=document.querySelectorAll(t)),t.length?[].slice.call(t):[t]},preload=function(t){var e=t.cloneNode(!1),r=e.dataset,n=r.src,o=r.srcset;return n&&(e.src=n),o&&(e.srcset=o),e};function display(t){t.dataset.src&&(t.src=t.dataset.src),t.dataset.srcset&&(t.srcset=t.dataset.srcset),t.removeAttribute("data-src"),t.removeAttribute("data-srcset")}var LazyLoader=function(){function r(t){_classCallCheck(this,r),this.images=toArray(t),this.settledCountdown=this.images.length,this.hasObservers=!1,this.onLoadCb=this.onErrorCb=this.onIntersectCb=this.onVisibleCb=function(){},this._init()}return _createClass(r,[{key:"_init",value:function(){this.images.forEach(translateDataset)}},{key:"_countDown",value:function(){this.settledCountdown--,!this.settledCountdown&&this.onAllSettledCb&&this.onAllSettledCb(this.images)}},{key:"_attachListeners",value:function(e,t){var r=this;t.addEventListener("load",function(t){display(e),r.onLoadCb(e),window.IntersectionObserver||(r.onIntersectCb(e),r.onVisibleCb(e)),r._countDown()}),t.addEventListener("error",function(t){display(e),r.onErrorCb(e),window.IntersectionObserver||(r.onIntersectCb(e),r.onVisibleCb(e)),r._countDown()})}},{key:"_setObservers",value:function(t){var e={root:(e=0<arguments.length&&void 0!==t?t:{}).root,rootMargin:e.rootMargin||"500px 500px 500px 500px",threshold:e.threshold||.01};this.intersectObs=new IntersectionObserver(function(t){var r=this;t.forEach(function(t){var e;t.intersectionRatio&&(e=preload(t.target),n._attachListeners(t.target,e),n.onIntersectCb(t.target),n.visibleObs.observe(t.target),r.unobserve(t.target))})},e),this.visibleObs=new IntersectionObserver(function(t){var e=this;t.forEach(function(t){t.intersectionRatio&&(n.onVisibleCb(t.target),e.unobserve(t.target))})},_objectSpread(_objectSpread({},e),{},{rootMargin:"0px 0px 0px 0px"}));var n=this;return this.hasObservers=!0,this}},{key:"loadAll",value:function(){var r=this;return this.images.forEach(function(t){var e=preload(t);r._attachListeners(t,e)}),this}},{key:"loadWithIO",value:function(t){var e=this,r=0<arguments.length&&void 0!==t?t:{};return window.IntersectionObserver?(this._setObservers(r),this.images.forEach(function(t){e.intersectObs.observe(t)}),this):this.loadAll()}},{key:"onLoad",value:function(t){return this.onLoadCb=t,this}},{key:"onError",value:function(t){return this.onErrorCb=t,this}},{key:"onAllSettled",value:function(t){return this.onAllSettledCb=t,this}},{key:"onVisible",value:function(t){return this.onVisibleCb=t,this}},{key:"onIntersection",value:function(t){return this.onIntersectCb=t,this}}],[{key:"loadOnScroll",value:function(t,e){return new r(t).loadWithIO(e)}},{key:"loadAll",value:function(t){return new r(t).loadAll()}}]),r}();module.exports=LazyLoader;